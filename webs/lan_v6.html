<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="x-frame-options" content="sameorigin">
<meta name="viewport" content="width=device-width; initial-scale=1.0" />
<title>movistar</title>
<link href="/mhs/css/style.css" rel="stylesheet" type="text/css" />
<!--<script src="/mhs/js/jquery.1.4.2-min.js" type="text/javascript"></script>-->
<!--<script src="/mhs/js/jquery-page.js" type="text/javascript"></script>-->
<!--Botton-->
<link type="text/css" rel="stylesheet" href="/mhs/css/ui.switchbutton.min.css" />
<!--<link type="text/css" rel="stylesheet" href="css/demo.css" />-->
<script type="text/javascript" src="/mhs/js/jquery-1.6.3.min.js"></script>
<script type="text/javascript" src="/mhs/js/jquery.tmpl.min.js"></script>
<script type="text/javascript" src="/mhs/js/jquery-ui-1.8.16.custom.min.js"></script>
<script type="text/javascript" src="/mhs/js/jquery.switchbutton.min.js"></script>
<script type="text/javascript" src="/mhs/js/main.js"></script>
<!--<script type="text/javascript" src="/mhs/js/networkMap/applications.js"></script>-->
<!--<script type="text/javascript" src="/mhs/js/index.js"></script>-->
<!--<script type="text/javascript" src="/mhs/js/jquery.json-2.2.js"></script>-->
<script type="text/javascript" src="/mhs/js/jquery.utils.homestation.min.js"></script>
<!--<script type="text/javascript" src="/mhs/js/languages.js"></script>-->
<script type="text/javascript">
function MM_swapImgRestore() { //v3.0
  var i,x,a=document.MM_sr; for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) x.src=x.oSrc;
}
function MM_preloadImages() { //v3.0
  var d=document; if(d.images){ if(!d.MM_p) d.MM_p=new Array();
    var i,j=d.MM_p.length,a=MM_preloadImages.arguments; for(i=0; i<a.length; i++)
    if (a[i].indexOf("#")!=0){ d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];}}
}

function MM_findObj(n, d) { //v4.01
  var p,i,x;  if(!d) d=document; if((p=n.indexOf("?"))>0&&parent.frames.length) {
    d=parent.frames[n.substring(p+1)].document; n=n.substring(0,p);}
  if(!(x=d[n])&&d.all) x=d.all[n]; for (i=0;!x&&i<d.forms.length;i++) x=d.forms[i][n];
  for(i=0;!x&&d.layers&&i<d.layers.length;i++) x=MM_findObj(n,d.layers[i].document);
  if(!x && d.getElementById) x=d.getElementById(n); return x;
}

function MM_swapImage() { //v3.0
  var i,j=0,x,a=MM_swapImage.arguments; document.MM_sr=new Array; for(i=0;i<(a.length-2);i+=3)
   if ((x=MM_findObj(a[i]))!=null){document.MM_sr[j++]=x; if(!x.oSrc) x.oSrc=x.src; x.src=a[i+2];}
}
</script>
</head>

<body onload="MM_preloadImages('/mhs/img/x3.png')">
 <!--top-->
 
 <!--wrapper-->
<div class="wrapper">
<div class="wrapper2">

<div id="pageloading" style="display: none" >
  <div id="loadingimg"><img src="/mhs/images/loading.gif" width="102" height="116" /></div>
</div>
    <div class="topBorder">
            <div class="top_LLBox"><div id="home"><img src="/mhs/img/meun.png" width="45" height="45" /></div><div id="menu" class="toptitle2">MENÚ</div>
            	<div id="pagemenu" class="menuList">
                	<ul>
                    	<!--li><a href="InicioLogout.cmd">Inicio</a></li-->
                        <li><a href="mhs.html">WiFi</a></li>
                        <li><a href="wifi5g.html">WiFi Plus</a></li>
                        <li><a href="wifisecond.html">WiFi Invitados</a></li>
                        <li><a href="PortForwardWizard.cmd?page=1">Puertos</a></li>
                        <li class="sec"><a href="#">Red local&nbsp;></a>
                        	<ul>
                            	<li><a href="networkmap.html">Mapa de red local</a></li>
                                <li><a href="lan_v4.html">Red Local</a></li>
                            </ul>
                        </li>
                        <li><a href="multipuesto.html">Multipuesto / Monopuesto</a></li>
                        <li><a href="lan_v6.html">IPv6</a></li>
                        <li><a href="changepasswd.html">Cambio contraseña del router</a></li>
                        <li><a href="firmwareupgrad.html">Actualizaciones Firmware</a></li>
                        <li><a href="configsetting.html">Otras funcionalidades</a></li>
                        <li class="sec"><a href="#">Ayuda&nbsp;></a>
                        	<ul>
                            	<li><a href="wizard_help.html">Ayuda configurador web</a></li>
                                <li><a href="sysinfo.html">Acerca de</a></li>
                            </ul>
                        </li>
                        <li><a href="advancedsettings.html">Configuración avanzada</a></li>
                    </ul></div>
                </div>
            <div class="top_CBox toptitle">Acceso al Configurador Router</div>
            <div class="top_RRBox logoBox_in"><img src="/mhs/img/logo.png"/></div>
    </div><!--top END-->
    <!--stlye_mins-->
    	<div class="topBorder2">
            <div class="toptitle2">Acceso al Configurador Router</div>
    	</div>
    <!--stlye_mins end-->
    <div class="mainBorder"><div class="items"><a href="javascript:void(0)" onclick="logoutBtu();">Cerrar sesión</a></div></div>
    <!--location-->
    <div class="locationTitle">Red Local IPv6</div><!--location end-->
    
    <!--MAIN-->
<div class="mainBorder">
<div id="logout" class="finBox">
    	<div class="artBox">¿Está seguro de que desea cerrar la sesión?<br/>
            </div><!--artBox-->
            <div class="artBox">
              <div class="leftBtu"><input type="button" name="button" id="button" value="Cancelar" class="checkBtu" onclick="closeDiv();"/></div>
              <div class="rightBtu"><input type="button" name="button" id="button" value="Aceptar" class="checkBtu" onclick="javascript:location.href='logout.cmd'"/></div>
            </div><!--artBox-->
    </div><!--finBox-->
   	<div class="artBox black2">Configuración DHCP IPv6</div>
  		<div class="artBox_nM">
        	
            <div class="tabBorder_46">
              <div class="tabID">Dirección local IPv6</div><div class="tabInput">
                <input name="uiViewIPAddrv6" type="text" class="chooseBox" id="uiViewIPAddrv6" SIZE="39" maxlength="39" readonly="true" VALUE=""/>
              </div></div><!--tabBorder_46-->
            
            <div class="tabBorder_46">
              <div class="tabID">Dirección global IPv6</div><div class="tabInput">
                <input name="uiViewNetGlobal" type="text" class="chooseBox" id="uiViewNetGlobal" SIZE="39" MAXLENGTH="39" readonly="true" VALUE=""/>
              </div></div><!--tabBorder_46-->
              
  		</div><!--artBox_nM-->
  		
  		<div class="artBox_nM">
          <div class="tabBorder_46">
              <div class="tabID">Longitud prefijo subred</div><div class="tabInput">
                <input name="uiViewNetMaskv6" type="text" class="chooseBox" id="uiViewNetMaskv6" SIZE="39" MAXLENGTH="39" readonly="true" VALUE=""/>
              </div></div><!--tabBorder_46-->
  		</div><!--artBox_nM-->
            

        
        <div class="artBox_nM">
        
       	  <div class="tabBorder_46">
   	      <input type="radio" name="RadioGroup1" value="Stateless" id="auto_configuration" onchange="changeAutoMode();"/><span class="sub">Autoconfiguración</span></div>
              
              <div class="tabBorder_46">
          <input type="radio" name="RadioGroup1" value="Stateful" id="fix_range" onchange="changeDhcpMode();"/><span class="sub">Rango fijo</span></div>
        </div>
        
        <div class="artBox_nM" id="lanv6Conf" style="display:none">
        
          <div class="tabBorder">
          <div class="tabID2">Dirección IP inicio de rango</div><div class="tabInput"><input type="text" name="StartIpv6" id="StartIpv6" class="chooseBox" SIZE="39" MAXLENGTH="39" VALUE="<%ejGet(ipv6IntfIDStart)%>" onBlur="checkDHCPv6PoolAddress(this, 0)" /></div></div>
          
          <div class="tabBorder">
          <div class="tabID2">Dirección IP fin de rango</div><div class="tabInput"><input type="text" name="PoolSizev6" id="PoolSizev6" class="chooseBox" SIZE="39" MAXLENGTH="39" VALUE="<%ejGet(ipv6IntfIDEnd)%>" onBlur="checkDHCPv6PoolAddress(this, 1)" /></div></div>
        </div>

		  <div class="tabBorder">
         	  <div class="rightBtu"><input type="button" name="editIP" id="editIP" value="Añadir" class="checkBtu" onclick="applylanv6IPconf();"/></div> 
       	  </div>
         
		<div class="artBox_nM">
		  <div class="tabBorder">
          <div class="tabID2"></div><div class="tabInput"><input name="button1" type="button" class="checkBtu" id="button1" value="Aceptar" onclick="lanv6accept()" hidden="hidden"/></div></div>		
		</div>
        
        <!--location-->
    	<div class="locationTitle">Puertos IPv6</div><!--location end-->
		<form id="form1" name="form1" method="post" action="">
<div class="markBg">
        	<div class="artBox_nM">Rellena los siguientes campos y pulsa el botón Añadir. Ten en cuenta que para abrir un rango de puertos debes usar el siguiente formato : 5001:5010</div>
            <div class="artBox_nM">
            	
                <div class="tabBorder">
                <div class="tabID">Nombre del puerto</div><div class="tabInput">
                  <input type="text" name="application_name" id="application_name" class="chooseBox"/>
                </div></div>
                
                <div class="tabBorder">
            	<div class="tabID">Dirección IPv6 global del dispositivo </div><div class="tabInput">
              	<input type="text" name="dstIPAddr" id="dstIPAddr" class="chooseBox"/>
            	</div></div>
        
        		<div class="tabBorder">
            	<div class="tabID">Protocolo</div><div class="tabInput">				   
            	  <select id="select_trafficN" class="chooseBox"  name="select_trafficN" onchange="hidePort();" >
					<option value='TCPorUDP' class='trad'>TCP+UDP</option>
					<option value='TCP'> TCP </option>
					<option value='UDP'> UDP </option>
					<!--option value='ICMPv6'> ICMPv6 </option-->
          	    </select>
            	</div></div>
				
				<div style="display: none">
                      <select id='select_interfaceN' name='select_interfaceN' class="wselect">
						<option value="ALL">ALL</option>
						<option value="WAN">ALL WAN</option>
						<option value="LAN">ALL LAN</option>						 
						<script language="JavaScript">
							var i=0;
							var interfaces = '<%ejGetOther(allIpInterfaceInfo)%>';
							var frwlIntf = interfaces.split('|');
							if(frwlIntf.length>0){  
								for ( i = 0; i < frwlIntf.length - 1; i++ ) {
									if(frwlIntf[i].indexOf("ppp")!=-1){
										document.write("<option value='" + frwlIntf[i] + "' selected>");
									}else{
										document.write("<option value='" + frwlIntf[i] + "'>");
									}
									document.writeln(frwlIntf[i]);
									
								}
							} 
                        </script>
                      </select>
						<select id='select_directionN' name='select_directionN' class="wselect">
							<option selected="selected" value="In">Input</option>
							<option value="Out">Output</option>
						</select>
						<select id='select_actionN' name='select_actionN' class="wselect">
							<option selected="selected" value="Permit">Allow</option>
							<option value="Drop">Deny</option>
							<option value="Reject">Reject</option>
						</select>					  

				</div>
  		
            	<div class="tabBorder">
            	<div class="tabID">Abrir Puerto/Rango de puertos</div><div class="tabInput">
              	<input type="text" name="ruleStartWanN" id="ruleStartWanN" class="chooseBox" maxlength='11' />
            	</div></div>
                
                <div class="tabBorder">
                	<div class="rightBtu"><input type="button" name="acceptApp" id="acceptApp" value="Añadir" class="checkBtu"/></div> 
              	</div>
                
            </div>
        </div>
        </div>
        
        <div class="artBox" id="rules_list" >
		 <div class="tabBorder_100">
                <div id="showIcon"><span class="blueLink"><a href="javascript:void(0)" onclick="del_show2();">Editar</a></span></div>
                <div id="closeIcon"><div class="tabInput"><span class="blueLink"><a href="javascript:void(0)" onclick="del_close2();">OK</a></span></div></div>
         </div>
		 <% ejGetOther(ip6FireWall_rule) %>
		</div>
	</form>
		<div id="fin" class="fin_item">
           <ul>
             <li id="calltab1"><a class="finBox" id="alink" href="#tab1">alink</a></li>
             <li id="calltab2"><a class="finBox" id="alink2" href="#tab2">alink2</a></li>
           </ul>
        </div><!--fin-->

		<div id="tab1" class="finBox">
            <div class="artBox" id="content" align="center">content<br/>
            </div>
            <div class="artBox">
                <div align="center"><input  name="button" id="button" value="Cerrar" style="text-align:center" class="checkBtu2" onclick="closeDiv();"/></div>
            </div>
        </div><!-- #tab1 finBox end-->
         <div id="tab2" class="finBox">
            <div class="artBox" id="content2" align="center">content<br/>
            </div><!--artBox-->
            <div class="artBox">
                <div align="center"><input  name="button" id="button" value="Cerrar" style="text-align:center" class="checkBtu2" onclick="closeDiv2();"/></div>
            </div>
        </div><!-- #tab2 finBox end-->
</div><!--main END-->
    
    <!--footer-->
    <div class="footerBorder">
    © Telefónica de España S.A.U. Todos los derechos reservados v 1.1
    </div><!--footer END-->
	
</div></div><!--wrapper END-->

</body>
<script type="text/javascript">
var delListNum = new Array();
var delListIntf = new Array();
var delListDir = new Array();
var delRulesNum = new Array();
var delRulesNode = new Array();

var newIntfDir = new Array();
var newPVCNum = new Array();
var newRuleNum = new Array();

var modifyListNum = new Array();
var modifyListIntf = new Array();
var modifyListDir = new Array();

var sub = document.getElementById("alink");
var sub2 = document.getElementById("alink2");

var StartWanN = 0;
var EndWanN = 0;
var gblsessionKey = <% ejGetOther(sessionKey)%>;

var pvcNum = "<%tcWebApi_get("TELFirewall_Common","FrwlNum","s") %>";
var inf = new Array("<%tcWebApi_get("TELFirewall_PVC_Entry0","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry1","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry2","Interface","s") %>",			  
		  "<%tcWebApi_get("TELFirewall_PVC_Entry3","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry4","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry5","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry6","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry7","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry8","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry9","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry10","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry11","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry12","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry13","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry14","Interface","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry15","Interface","s") %>")
var dir = new Array("<%tcWebApi_get("TELFirewall_PVC_Entry0","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry1","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry2","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry3","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry4","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry5","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry6","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry7","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry8","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry9","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry10","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry11","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry12","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry13","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry14","Direction","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry15","Direction","s") %>")
var rulenum = new Array("<%tcWebApi_get("TELFirewall_PVC_Entry0","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry1","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry2","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry3","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry4","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry5","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry6","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry7","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry8","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry9","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry10","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry11","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry12","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry13","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry14","RuleNum","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry15","RuleNum","s") %>")
var ipver = new Array("<%tcWebApi_get("TELFirewall_PVC_Entry0","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry1","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry2","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry3","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry4","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry5","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry6","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry7","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry8","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry9","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry10","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry11","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry12","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry13","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry14","IPVersion","s") %>",
		  "<%tcWebApi_get("TELFirewall_PVC_Entry15","IPVersion","s") %>")

$(document).ready(function() {	
	
	$.fx.speeds._default = 500;
	jQuery.getJSON('/mhs/config.json', function(data, textStatus){
		//STATUS = data.STATUS;
		CONFIG = data.CONFIG;
		configurationLoaded();
	});

	changeAutoMode();
	fillLanIPv6info();
	
	$('#acceptApp').click(function() {
        createNewApplication();		
	});
	
	$('#DeleteAll').click(function() {
	//	alert("DeleteAll!"); 
		deleteAll();
	});	
	
	$("#frwRule").find("input").val("");
	$("#frwRule").find("input.gray_icon").val("Añadir");
	
	for(i=0;i<32;i++)
	{
		delListNum[i]="-1";
		delListIntf[i]="-1";
		delListDir[i]="-1";
		delRulesNum[i]="-1";
		delRulesNode[i]="-1";
		newIntfDir[i]="-1";
		newPVCNum[i]="-1";
		newRuleNum[i]="-1";
		
		modifyListNum[i]="-1";
		modifyListIntf[i]="-1";
		modifyListDir[i]="-1";
		//totNum[i]="-1";
	}
	
	$(".common:checkbox").switchbutton();
	
	$('.common').change(function(){
	   if($(this).attr('checked')){
			editClick($(this).val());
	   }else{
			editClick($(this).val());
	   }
	});
	
	$('.del_icon2').click(function(){
		var value=$(this ).attr('value');
	  	deleteClick(value);	  
	});
	
	
/*	
	$('#rules_list').load('FireWallRulev6.cmd', function(){
		$('#actionName').text("Acción");
	});			
*/	
});

function applylanv6IPconf()
{
	var data = {
		sessionKey: gblsessionKey,				
		submitValue: "IpSubmit",
		StartIpv6:$("#StartIpv6").attr("value"),
		EndIpv6: $("#PoolSizev6").attr("value"),
		stateless: $('input[name=RadioGroup1]:checked').val()
	}	

	var url = "/lan_v6.cmd";
	var callback = function(responseData, textStatus){
		//$.closeLoadingMask(1);
		window.parent.location.reload();
	};
	
	//$.openLoadingMask(1);
	$.post(url, data, callback, "cmd");		
	loadingProcess();
}


function fillLanIPv6info()
{
	var ipv6ulaAddrStr = '<%ejGetOther(lanIpv6LinkLocalAddr)%>';
	var ipv6GlobalAddrStr = '<%ejGetOther(lanIpv6GlobalAddr)%>';
	var ipv6ulaAddr = ipv6ulaAddrStr.split("/");
	var ipv6GlobalAddr = ipv6GlobalAddrStr.split("/");
	var mode = <%ejGet(enblDhcp6sStateful)%>;
	
	$('#uiViewIPAddrv6').val(ipv6ulaAddr[0]);
	$('#uiViewNetGlobal').val(ipv6GlobalAddr[0]);
	if(ipv6GlobalAddr.length==2){
		$('#uiViewNetMaskv6').val(ipv6GlobalAddr[1]);
	}
	
	if(mode){	
		$("#fix_range").attr('checked', 'checked');
		document.getElementById("lanv6Conf").style.display="";
	}else{
		$("#auto_configuration").attr('checked', 'checked');
		document.getElementById("lanv6Conf").style.display="none";
	}
	
}

function chkPortRange()
{	
	//alert("chkPortRange");

	if(document.form1.ruleStartWanN.value.match(':')!=null)
	{
		var tmp = document.form1.ruleStartWanN.value.split(":");
		StartWanN = parseInt(tmp[0]);
		EndWanN = parseInt(tmp[1]);
	}
	else
	{
		StartWanN =  parseInt(document.form1.ruleStartWanN.value);
		EndWanN = StartWanN;
	}
	port = StartWanN;
	port2 = EndWanN;
	
	if ((document.getElementById("select_trafficN").selectedIndex != 3) && (port > 65535 || port < 1 || port2 > 65535 || port2 < 1 || (port != '' && isNaN(port)) || (port2 != '' && isNaN(port2) ) ))
	{	
		//alert(document.getElementById("MLG_PortRangeError_JS").innerHTML);
//		   alert("Port range error !(0-65535)");
		$('#content').text("Debe ingresar puertos comprendidos dentro del rango de (0-65535)");
		sub.click();
		   return true;	
	}
	if (port2 < port)
	{	
		$('#content').text("Puerto final debe ser mayor puerto de inicio.");
		sub.click();
		//alert("End port must greater than Start port.");
		//alert(document.getElementById("MLG_PortFD_Error_1").innerHTML);
		return true;
	}
	var conReqPort="<%ejGet(tr69cReqPort)%>";
//	var PortForwarding_Port_CWMP_Error="Port " +conReqPort+ " is used for CWMP!";
	if ( (port == conReqPort || port2 == conReqPort)  && ( document.getElementById("select_trafficN").selectedIndex != 2)  )
	{
		//alert(conReqPort+document.getElementById("MLG_NAT_Port_CWMP_Error").innerHTML);
		//alert(conReqPort + 'Port is used for CWMP!');
		$('#content').text(conReqPort + "Port is used for CWMP!");
		sub.click();
		return true;
	}	
	if ((port <= conReqPort && port2 >= conReqPort) && ( document.getElementById("select_trafficN").selectedIndex != 2) ) 
	{
		//alert(conReqPort+document.getElementById("MLG_NAT_Port_CWMP_Error").innerHTML);
		//alert(conReqPort + 'Port is used for CWMP!');
		$('#content').text(conReqPort + "Port is used for CWMP!");
		sub.click();
		return true;
	}	
	return false;
}

function validateForm(){

	if (chkPortRange())
		return false;	
	if (document.form1.dstIPAddr.value != '' && !checkIPv6Address(document.form1.dstIPAddr))
	{
		//alert("Invalid Src IPv6 Address");
		$('#content').text("Dirección IPV6 Invalida");
		sub.click();
		return false;
	}		
	if(document.getElementById("application_name").value==""){
		//alert('Please input the Rule Name');
		//alert(document.getElementById("MLG_PortFD_Error_2").innerHTML);
		$('#content').text("Please input the Rule Name");
		sub.click();
		return false;
	}
	return true;
}

function deleteAll(){
		
	var data = {
		sessionKey: gblsessionKey,				
		submitValue: "DelAll"
	}	

	var url = "/FireWallRulev6.cmd";
	var callback = function(responseData, textStatus){
		//$.closeLoadingMask(1);
		window.parent.location.reload();
	};
	
	//$.openLoadingMask(1);
	$.post(url, data, callback, "cmd");		
	loadingProcess();
	
}

function chkdualRule()
{
	var RuleTable = $("#rules_list .tabBorder_100");
	var flag= 0;
	
	if(document.form1.ruleStartWanN.value.match(':')!=null)
	{
		var tmp = document.form1.ruleStartWanN.value.split(":");
		StartWanN = parseInt(tmp[0]);
		EndWanN = parseInt(tmp[1]);
	}
	else
	{
		StartWanN =  parseInt(document.form1.ruleStartWanN.value);
		EndWanN = StartWanN;
	}
		
	for(i=0;i<(RuleTable.length-1); i++){
		flag=0;		
		protocol = $("#rules_list #Protocol"+i).val();
		//src_ip= $("#rules_list #SrcIP"+i).val();
		//src_port= $("#rules_list #PortRang"+i).val();
		dst_ip= $("#rules_list #DstIP"+i).val();
		dst_port= $("#rules_list #PortRang"+i).val();
		interface= $("#rules_list #Interface"+i).val();
		direction= $("#rules_list #Direction"+i).val();
		action= $("#rules_list #Action"+i).val();
		//var f_dst_port = document.getElementById("ruleStartWanN");
		var ObjProto = document.getElementById("select_trafficN");
		var ObjDirection = document.getElementById("select_directionN");
		var Objaction = document.getElementById("select_actionN");
		
		
		if(protocol == ObjProto.options[ObjProto.selectedIndex].value || ObjProto.options[ObjProto.selectedIndex].value == "TCPorUDP"){
			flag++;
		}


//		if(src_port == f_src_port){
//			flag++;
//		}
		
//		var f_dst_port = $("#ruleStartLanN").val() + ":" + $("#ruleEndLanN").val();

		
		var tmp = dst_port.split(":");
		var checkWanPortStart = parseInt(tmp[0]);
		var checkWanPortEnd = parseInt(tmp[1]);

		if((StartWanN >= checkWanPortStart) && (StartWanN <= checkWanPortEnd))
		{
			flag++;
		}	
		else if((EndWanN >= checkWanPortStart) && (EndWanN <= checkWanPortEnd))
		{
			flag++;
		}
		else if((StartWanN <= checkWanPortStart) &&  (EndWanN >= checkWanPortStart))
		{
			flag++;
		}	
		else if((StartWanN >= checkWanPortEnd) &&  (EndWanN <= checkWanPortStart))
		{
			flag++;
		}
//		if(src_port == f_src_port){			
//			flag++;
//		}
		
//		var f_dst_port = $("#ruleStartLanN").val() + ":" + $("#ruleEndLanN").val();
//		if(src_ip == $("#srcIPAddr").val()){			
//			flag++;
//		}
		if(dst_ip == $("#dstIPAddr").val()){
			flag++;
		}
		if(flag==3){
			//alert("Has same firewall rule");
			$('#content').text("Has same firewall rule");
			sub.click();
			return -1;
		}		
	}
	return 0;
}

function deleteClick(del_value) {
	var value=del_value.split(",");

	var data = {
		sessionKey: gblsessionKey,
		key1: parseInt(value[0]),
		key2: parseInt(value[1]),
		submitValue: "Del"		
	};
			
    var url = "/FireWallRulev6.cmd";
	var callback = function(responseData, textStatus){
		//$.closeLoadingMask(1);
		window.parent.location.reload();
	};
	//$.openLoadingMask(1);	
	$.post(url, data, callback, "cmd");
	loadingProcess();
}

//function editClick(entry,index,RuleAction) {
function editClick( edit_value) {
	
	var value=edit_value.split(",");

	var data = {
		sessionKey: gblsessionKey,
		key1: parseInt(value[0]),
		key2: parseInt(value[1]),
		submitValue: "Edit"				
	};
	
	if (parseInt(value[2])==0)
		data.active = "No";
	else
		data.active = "Yes";
		
    var url = "/FireWallRulev6.cmd";
	var callback = function(responseData, textStatus){		
		window.parent.location.reload();
	};
	
	$.post(url, data, callback, "cmd");
	loadingProcess();
	
}

function createNewApplication(){
  //  getdataNatRuleNum();
	var completeSaveTimeAppIPv4 = 0;
	var reloadTimeAppIPv4 = 0;
	var dataHaveError = 0;
	var ObjIntf = document.getElementById("select_interfaceN");
	var ObjDir = document.getElementById("select_directionN");
	
	if (!validateForm()){
		return false;
	}
	if(-1==chkdualRule()){
		return false;
	}
		
	var data = {
	    sessionKey: gblsessionKey,
		active: "Yes",
		icmptype:"destination-unreachable",
		ipType: "IPv6",
		rejecttype:"no-route",
		fwaction:"Drop",
		appNameGen: "UserDefined_IPv6"+ObjDir.options[ObjDir.selectedIndex].value,
		appName: document.getElementById("application_name").value,
		srcPrefix:"128",
		dstPrefix:"128"		
	};	
	
	var RuleAction = document.getElementById("select_actionN");	
	var Protocol = document.getElementById("select_trafficN");		
	
	
		
	data.fwdirName = ObjDir.options[ObjDir.selectedIndex].value;
	data.fwintfName = ObjIntf.options[ObjIntf.selectedIndex].value;	
	
		
	data.submitValue = "Add";
	data.action = RuleAction.options[RuleAction.selectedIndex].value;		

	if(ObjDir.options[ObjDir.selectedIndex].value == "In"){
		data.dirName = ObjIntf.options[ObjIntf.selectedIndex].value+"I6";
	}
	else if(ObjDir.options[ObjDir.selectedIndex].value == "Out"){
		data.dirName = ObjIntf.options[ObjIntf.selectedIndex].value+"O6";
	}
	data.srcaddr =  "";
	data.dstaddr = document.getElementById("dstIPAddr").value;
	data.protocol = Protocol.options[Protocol.selectedIndex].value;
	data.startWan = StartWanN;
	data.endWan = EndWanN;
	data.startLan = StartWanN;
	data.endLan = EndWanN;	
	
	if(isNaN(data.startWan))
	   data.startWan ="";
	if(isNaN(data.endWan))
	   data.endWan ="";
	if(isNaN(data.startLan))
	   data.startLan ="";  
	if(isNaN(data.endLan))
	   data.endLan ="";	   

    var url = "/FireWallRulev6.cmd";
	var callback = function(responseData, textStatus){
		//$.closeLoadingMask(1);
		window.parent.location.reload();
	};
	//$.openLoadingMask(1);
	$.post(url, data, callback, "cmd");
	loadingProcess();
}

/*
function str_trim(address)
{
    var l=0;
	var r=0;
	
	r=(address.length)-1;
	
    while(l < address.length && address[l] == ' ')
    {     
		l++; 
	}
    while(r > l && address[r] == ' ')
    {     
		r-=1;     
	}
    return address.substring(l, r+1);
} 
*/

function inValidIPv6Addr(Address1)
{
	var regExp = /^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/;
	
	var Address = $.trim(Address1);
	var address = Address.match(regExp);
	if(address == null){	
 	return true;
	}	
	return false;
}

function checkIPv6Address(object)
{
	var ret = false;
	var address=object.value;
	ret = inValidIPv6Addr(address);
	if(ret == true)
	{
	    //alert("InvalidIPv6 Address");
		$('#content').text("Dirección IPV6 Invalida");
		sub.click();
		return false;
	}
	return true;
}

function checkIPv6PrefixLength(object)
{	
	var length=object.value;
	
	if((length < 1) ||(length > 128))
	{	
	    //alert("InvalidIPv6 Prefix Length");
		$('#content').text("Invalid IPv6 Prefix Length");
		sub.click();
		return false;
	}
	return true;

}


function checkIPv6AddressFormat(uiViewIPv6Addr)
{
	var ret = false;
	ret = inValidIPv6Addr(uiViewIPv6Addr);
	if(ret == true)
	{
		return false;
	}
	return true;
}


function isValidDHCPv6PoolAddress(addrv6)
{
	var addrv6Splits = addrv6.split(':', 5);
	var regExp = /^([0-9A-Fa-f]{1,4})$/;
	var index = 0;

	// pool address should less then 64 length
	if (addrv6Splits.length != 4) {
		return false;
	}

	for (index=0; index<4; index++) {
		if (addrv6Splits[index].match(regExp) == null) {
			return false;
		}
	}

	return true;
}

function checkDHCPv6PoolAddress(object, isStart)
{
	if (isValidDHCPv6PoolAddress(object.value) == false) {
		if (isStart == 0) {
			//alert("invalid IPv6 Start interface ID : " + object.value);
			$('#content').text("invalid IPv6 Start address : " + object.value);
			sub.click();
		} else {
			//alert("invalid IPv6 End interface ID : " + object.value);
			$('#content').text("invalid IPv6 End address : " + object.value);
			sub.click();
		}
		return false
	}

	return true;
}

function isValidDHCPv6PoolRange(addrv6Start, addrv6End)
{
	var startSplits = addrv6Start.split(':', 5);
	var endSplits = addrv6End.split(':', 5);
	var index = 0;

	for (index=0; index<4; index++) {
		if (parseInt(startSplits[index], 16) > parseInt(endSplits[index], 16)) {
			return false;
		}
	}

	return true;
}

function checkDHCPv6PoolRange(objectStart, objectEnd)
{
	if (isValidDHCPv6PoolAddress(objectStart.value) == false) {
		//alert("invalid IPv6 Start address : " + objectStart.value);
		$('#content').text("invalid IPv6 Start address : " + objectStart.value);
		sub.click();
		return false;
	} else if (isValidDHCPv6PoolAddress(objectEnd.value) == false) {
		//alert("invalid IPv6 End interface ID : " + objectEnd.value);
		$('#content').text("invalid IPv6 End address : " + objectEnd.value);
		sub.click();
		return false;
	} else if (isValidDHCPv6PoolRange(objectStart.value, objectEnd.value) == false) {
		//alert("invalid IPv6 pool range");
		$('#content').text("invalid IPv6 pool range");
		sub.click();
		return false;
	}

	return true;
}


function changeAutoMode()
{

	if($('#auto_configuration').attr('checked'))
	{

		$('#fix_range').attr("checked", false);
		hideLANv6();
	}
	else
	{

		$('#fix_range').attr("checked", true);
		showLANv6();
	}

}

function hidePort()
{
  if(document.getElementById("select_trafficN").selectedIndex == 3)
  {
		document.form1.ruleStartWanN.value = '';
	  	document.form1.ruleStartWanN.disabled = true;
  }
  else
  {
	  	document.form1.ruleStartWanN.disabled = false;
  }
}
function changeDhcpMode()
{

	if($('#fix_range').attr('checked'))
	{
		$('#auto_configuration').attr("checked", false);
		showLANv6();
	}
	else
	{
		$('#auto_configuration').attr("checked", true);
		hideLANv6();
	}
	showLANv6();
}

function showLANv6(){
    //$("#lanv6Conf").css('display', 'block');
    $("#lanv6Conf").show();
}

function hideLANv6(){
    $("#lanv6Conf").hide();
}

var lanv6warningsactived = false;

function prepareLAN6JSON(){
	var key = new Object();
	key.sessionKey=gblsessionKey;
	var lanv6 = new Object();
	lanv6.IPAddr = $("#uiViewIPAddrv6").attr("value");
	lanv6.Mask = $("#uiViewNetMaskv6").attr("value");
    var dhcpv6 = new Object();
	dhcpv6.auto   = $("#auto_configuration").attr("checked");

	if (dhcpv6.auto == 'checked') {
		dhcpv6.auto = "1";
	}else{
		dhcpv6.poolStart = $("#StartIpv6").attr("value");
		dhcpv6.PoolSize = $("#PoolSizev6").attr("value");
		dhcpv6.auto = "0";
	}
	var dnsv6 = new Object();
	dnsv6.PrimaryDns = $("#PrimaryDnsv6").attr("value");
	dnsv6.SecondDns = $("#SecondDnsv6").attr("value");

    var LANJSON = new Object();
	LANJSON.KEY = key;
    LANJSON.LANV6 = lanv6;
    LANJSON.DHCPV6 = dhcpv6;
	LANJSON.DNSV6 = dnsv6;	

    var LANJSONstring = $.toJSON(LANJSON);
    return LANJSONstring;
}

function checkIPv6IPFormat(LAN6JSON){
	var postData = eval ("(" + LAN6JSON + ")");
			
	
	if(checkIPv6AddressFormat(postData.DNSV6.PrimaryDns)==false || checkIPv6AddressFormat(postData.DNSV6.SecondDns)==false){
      	//alert(_("INVALID_IPV6_ADDRESS_MSG"));
		$('#content').text(_("INVALID_IPV6_ADDRESS_MSG"));
		sub.click();
        return false;
     }
	
	return true;
}

function lanv6accept(){
    lanv6warningsactived = false;
    var LAN6JSON = prepareLAN6JSON();
	
	if (checkDHCPv6PoolRange(document.getElementById("StartIpv6"), document.getElementById("PoolSizev6")) == false) {
		return;
	}
	
	loadingProcess();

	/*
	if(checkIPv6IPFormat(LAN6JSON)==false)
		return;
	*/

    setLAN6Configuration(LAN6JSON, function(success, error_desc){
        if (!success) {
            //alert(_(error_desc));
			$('#content').text(_(error_desc));
			sub.click();
        } else {
            window.location.reload();
        }
    });   
}

//returnJSON structure 
function setLAN6Configuration(LAN6JSON, callback){
	var postData = eval ("(" + LAN6JSON + ")");
	//var dhcpstatusv6= postData.DHCPV6.status;
	
	postData.DHCPV6.status=1;
	$.ajax({
		url: 'lan_v6.cmd',
		dataType: 'json',
		type:'post',
		cache: false,
		complete: callback,
		data: {
			submitValue: "Apply",
			sessionKey: postData.KEY.sessionKey,
			//IPAddrv6: postData.LANV6.IPAddr,
			//Maskv6: postData.LANV6.Mask,
			dhcpstatusv6: postData.DHCPV6.status,		
			auto: postData.DHCPV6.auto,
			poolStartv6: postData.DHCPV6.poolStart,
			poolSizev6:postData.DHCPV6.PoolSize,
			//PrimaryDnsv6: postData.DNSV6.PrimaryDns,
			//SecondDnsv6: postData.DNSV6.SecondDns
		}
	});
}

function loadingProcess(){
	$("#pageloading").css("display","block");
	setTimeout("location.reload(true);",5000);
	$("#pageloading").fadeOut(5000)
}
</script>
</html>