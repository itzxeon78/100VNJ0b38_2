<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
      <meta http-equiv="x-frame-options" content="sameorigin">
      <link rel="stylesheet" href='stylemain.css' type='text/css'>
         <link rel="stylesheet" href='colors.css' type='text/css'>
            <script language="javascript" src="util.js"></script>
            <script language="javascript">
<!-- hide

var wlRefresh = '<%ejGetExtWl(wlRefresh)%>';
var hide = '<%ejGetExtWl(wlHide_wl0v0)%>';
var WscMode       = '<%ejGetExtWl(wlWscMode)%>'; //WPS enable/disable
var WscAPMode  = '<%ejGetExtWl(wlWscAPMode)%>'; // WPS configured/unconfigured
var WscDevPin    = '<%ejGetExtWl(wlWscDevPin)%>';
var WscStaPin     = '<%ejGetExtWl(wlWscStaPin)%>';
var wlWscReGen     = '<%ejGetExtWl(wlWscReGen)%>';
var wltestMode     = '<%ejGetExtWl(wltestMode)%>';
var ssidIdx = '<%ejGetExtWl(wlSsidIdx)%>';

if ( wlRefresh == '1' || wlWscReGen == '1') 
{	
	var code = 'location="wlextwpsrefresh.wl?wlRefresh=0"';
	eval(code);   
}
function loadSsidList(OnPageLoad)
{
	var sel_wlSsidIdx =0;
	var idx =0;
	
	/* save selected */   
	if(OnPageLoad) 
	{      
		sel_wlSsidIdx = ssidIdx;
	}
	else 
	{
		sel_wlSsidIdx = document.forms[0].wlSsidIdx.value;
	}
	/* load list */
	document.forms[0].wlSsidIdx.length = 0;
	<%ejGetExtWl(wlSsidOption)%>

	/* mark selected */
	for (idx=0; idx<document.forms[0].wlSsidIdx.options.length; idx++)
	{
		if (document.forms[0].wlSsidIdx.options[idx].value == sel_wlSsidIdx)
		{
			document.forms[0].wlSsidIdx.options[idx].selected = true;
			break;
		}
	}	
}
function wlSsidIdxChange() 
{
	var loc = '';

	with ( document.forms[0] )
	{
		loc += 'wlextwpsrefresh.wl?';
		loc += 'wlSsidIdx='+wlSsidIdx.value;
	}
	loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
	var code = 'location="' + loc + '"';
	eval(code);		
}
function wscModeChange(OnPageLoad) 
{
	with( document.forms[0] )
	{
		var wscMode = getSelect(wlWscMode);
		
		switch ( wscMode )
		{
			case 'enabled': // WSC Enable
				showhide("divWscDevPin", 1);
				showhide("divWscConfigAp", 1 );
				showhide("divWscAPMode", 1 );
				showhide("divWscStaPin", 1);
				showhide("divWscButPin", 1);
				break;	  
			case  'disabled':  //WSC Disable
				showhide("divWscDevPin", 0);
				showhide("divWscConfigAp", 0 );
				showhide("divWscAPMode", 0);
				showhide("divWscStaPin", 0);
				showhide("divWscButPin", 0);
				break;
		}
	}
}

function wscAPModeChange(OnPageLoad) 
{
	with ( document.forms[0] ) 
	{
		var wscMode = getSelect(wlWscMode);
		if( wscMode == "enabled") 
		{
			showhide("divWscDevPin", 1);
			showhide("divWscAPMode", 1);
			showhide("divWscStaPin", 1);
			showhide("divWscButPin", 1);
		}
	}
}

function pin_window(pin)
{
	with(document.forms[0])
	{
		var w = window.open("", "", "toolbar=no,width=500,height=100");
		w.document.write('<font size=5><b><center>' + pin + '</center></b></font>');
		w.document.close();
	}
}

function getWpaIndex(v) 
{
	var i;
	for (i = 0; i < document.forms[0].wlWpa.length; i++)
	{
		if (document.forms[0].wlWpa[i].value == v)
		{
			return i;
		}
	}
	return 0;
}

function help_window()
{
	with(document.forms[0])
	{
		var w = window.open("", "", "toolbar=no,width=500,height=100");
		w.document.write('Input Station Pin from Client<br>');
		w.document.close();
	}
}

function devpin_window(pin)
{
   with(document.forms[0])
   {
      var w = window.open("", "", "toolbar=no,width=500,height=100");
      w.document.write('Device Pin is generated by AP<br>');
      w.document.close();
    }
}

function frmLoad() 
{
	with ( document.forms[0] ) 
	{   
		wlWscDevPin.value = WscDevPin;
		wlWscDevPin.readOnly = true;
		if(WscStaPin == '0')
		{
			wlWscStaPin.value = '';
		}
		else 
		{
			wlWscStaPin.value = WscStaPin;		
		}
		wlWscStaPin.readOnly = false;
		if( WscMode != 'enabled' && WscMode!= 'disabled' )
		{
			WscMode = 'disabled';
			showhide("divWscMode", 0);
		}
		setSelect(wlWscMode, WscMode );	
		
		if(wltestMode == 1)
		{
			wlWscAPModeName = new Array("Configured", "Unconfigured");
			wlWscAPModeValue = new Array("1", "0");
		}
		else
		{
			wlWscAPModeName = new Array("Configured");
			wlWscAPModeValue = new Array("1");
		}		

		wlWscAPMode.length = wlWscAPModeName.length;
		for(var i in wlWscAPModeName)
		{
			wlWscAPMode[i] = new Option(wlWscAPModeName[i], wlWscAPModeValue[i]);
			wlWscAPMode[i].value = wlWscAPModeValue[i];
		}			
		setSelect(wlWscAPMode, WscAPMode );	
		if(hide == 1)
		{
			wlWscMode.disabled =1;
		}

	}
	wscModeChange(1);
	wscAPModeChange(1);
	loadSsidList(1);
}

function btnApply( place ) 
{
	var wscApMode = getSelect(document.forms[0].wlWscAPMode);		
	var loc = '';
	loc += 'wlextwps.wl?';
	
	switch ( place )
	{
		case 'wlWscButAddClient.wl':
			loc += 'wlWscStaPin=0';
			loc += '&wpsTriggerType=pbc';
			break;

		case 'wlWscStaAddClient.wl':
			var reg = /\s/g;
			var isStaPinInvalid = false;
			var legal_pin_digit = /^[0-9]*$/;

			/*2.4G and 5G STA PIN column could accept 9 PIN code or other invalid characters. 20160602, Jessica*/
			if ((document.forms[0].wlWscStaPin.value != '') && (document.forms[0].wlWscStaPin.value.length != 8) && (document.forms[0].wlWscStaPin.value.length != 9) && (document.forms[0].wlWscStaPin.value.length != 4))
                          isStaPinInvalid = true;
			 
			if (document.forms[0].wlWscStaPin.value != '')
			{
				if (((document.forms[0].wlWscStaPin.value.length == 8) || (document.forms[0].wlWscStaPin.value.length == 4)) && (!legal_pin_digit.test(document.forms[0].wlWscStaPin.value)))
					isStaPinInvalid = true;
					
				if (document.forms[0].wlWscStaPin.value.length == 9)
				{
					var firstFourString = document.forms[0].wlWscStaPin.value.substring(0, 4);
					var lastFourString = document.forms[0].wlWscStaPin.value.substring(5, 9);

					if (!legal_pin_digit.test(firstFourString) || !legal_pin_digit.test(lastFourString))
						isStaPinInvalid = true;

					if ((document.forms[0].wlWscStaPin.value.charAt(4) != "-") && (document.forms[0].wlWscStaPin.value.charAt(4) != " "))
						isStaPinInvalid = true;

				}

				
			}

			if (document.forms[0].wlWscStaPin.value == '')
				isStaPinInvalid = true;

			if (isStaPinInvalid == true) {
				alert('Invalid STA PIN!');
				return;
			} 
			
			document.forms[0].wlWscStaPin.value = document.forms[0].wlWscStaPin.value.replace(reg, "");
			reg = /[-]/g;
			document.forms[0].wlWscStaPin.value=document.forms[0].wlWscStaPin.value.replace(reg,"");	
			loc += 'wlWscStaPin=' + encodeUrl(document.forms[0].wlWscStaPin.value);
			loc += '&wpsTriggerType=stapin';
			break;

		case 'wlWscConfigAp.wl': //Regenerate AP pin
			loc += 'wlWscReGen=1';
			loc += '&wlWscStaPin=0';      
			loc += '&wlWscAPMode=0';
			loc += '&wpsTriggerType=regenApPin';
			loc += '&SetupLock=false';
			loc += '&SetupLockedState=Unlocked';
			break;

		case 'wlextcfg.wl':
			loc += 'wlWscStaPin=0';
			loc += '&wpsTriggerType=none';
			break;
	}
   
	with ( document.forms[0] )
	{
		var vwscMode = getSelect(wlWscMode); //WPS enable/disable
		var vwscAPMode  =getSelect(wlWscAPMode); // WPS configured (1)/uncofngiured (0)
		var value;
		
		if(vwscMode == 'enabled')
		{
			if(vwscAPMode == '0') // unconfigured
			{
				 loc += '&wl_wsc_mode=unconfigured';
				 loc += '&wlWscAPMode=0'; 
			}
			else if(vwscAPMode == '1') // configured
			{
				loc += '&wl_wsc_mode=configured';
				loc += '&wlWscAPMode=1';
			}
		}
		else
		{
			loc += '&wl_wsc_mode=disabled';
		}
	}
	loc += '&sessionKey=<%ejGetOther(sessionKey)%>';
	var code = 'location="' + loc + '"';
	eval(code);
}

// done hiding -->
      </script>
   </head>
   <body onLoad='frmLoad()'>
      <blockquote>
         <form onSubmit='return false'>
            <b>Wireless -<a href="javascript:ShowFullItem(1)" border=0 style="text-decoration:none; cursor:text;">-</a> 5GHz WPS</b><br>
            <br>Enabling Wi-Fi Protected Setup (WPS) lets you add new WPS-compatible devices to the wireless network with ease. Select one of the WPS methods and follow the instructions to establish WPS connection. If your wireless client device is equipped with a WPS button, Push Button Configuration (PBC) method would be the preferable way to do WPS<br>
            <br>
            <br>
           <div id="divwlSsidIdx">
            <table border="0" cellpadding="0" cellspacing="0">
            <tr>
             <td width='180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Select SSID</td>
                  <td><select name='wlSsidIdx' size="1" onChange='wlSsidIdxChange()'> 
                     </select></td>
            </tr>
            </table>
            </div>            
            <div id="divWscMode">
             <br><br>             
             <b>WPS Setup</b><br><br>           
            <table border="0" cellpadding="0" cellspacing="0">
            <tr>
             <td width='180'> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enabled WPS</td>
                  <td><select name='wlWscMode' size="1" onChange='wscModeChange(0)'> 
                     <option value="enabled">Enabled</option>
                     <option value="disabled">Disabled</option>    
                     </select></td>
            </tr>
            </table>
            <br>
            </div>
           <div id="divWscAPMode">
            <table border="0" cellpadding="0" cellspacing="0">
            <tr>
             <td width='180'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Setup WPS AP Mode</td>
                  <td><select name='wlWscAPMode' size="1" onChange='wscAPModeChange(0)'> 
                     </select></td>
            </tr>
            </table>
            </div>

            <div id="divWscConfigAp">
            <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Setup AP (Configure all security settings with an external registrar) <br>
            <table border="0" cellpadding="0" cellspacing="0">
           </tr>
            </table>
            </div>

            <div id="divWscButPin">
	            <br>
                  <table border="0" cellpadding="0" cellspacing="0">
                   <tr>
                        <td width='180'> <b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WPS PBC:</b></td>                        
                        <td>
                           <input name='addEnBtn' type='button' onClick='btnApply("wlWscButAddClient.wl")' value='WPS PBC '>
                     </td>
                  </tr>               
                 </table>
            </div>
          
            <div id="divWscStaPin">
	            <br>
                  <table border="0" cellpadding="0" cellspacing="0">
                   <tr>
                        <td width='180'> <b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WPS Station PIN: </b></td>
                        <td>
                                  <input type='text' name='wlWscStaPin' size='20' maxlength='9'> &nbsp;&nbsp;
                        </td>
                        <td>
                                    <A HREF="javascript:help_window()"></A> 
                        </td>
                        <td>
                           &nbsp;<input name='addEnBtn' type='button' onClick='btnApply("wlWscStaAddClient.wl")' value='Add Enrollee'>
                     </td>
                  </tr>               
                 </table>
            </div>

             <div id="divWscDevPin">
	            <br>
                  <table border="0" cellpadding="0" cellspacing="0">
                   <tr>
                        <td width='180'> <b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; WPS AP PIN:</b></td>
                        <td>
                                  <input type='text' name='wlWscDevPin' size='20' maxlength='8'> &nbsp;&nbsp;
                        </td>
                        <td>
                           &nbsp;&nbsp;<input type='button' onClick='btnApply("wlWscConfigAp.wl")' value=' Regenerate '>
                     </td>
                     <td>
                                   <A HREF="javascript:devpin_window()">Diagnostics Help</A>
                        </td>
                  </tr>
                 </table>
            </div>

           <div id="divApply">           
              <table border="0" cellpadding="4" cellspacing="0">
               <tr> <td>        
               <input type='button' onClick='btnApply("wlextcfg.wl")' value='Apply/Save'>
               </tr> </td>
              </table>
           </div>
         </form>
      </blockquote>
   </body>
</html>
